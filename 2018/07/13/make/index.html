<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="ssh centos@192.168.9.35 sudo yum install docker sudo service docker start sudo vi /etc/group 查看当前已有的用户组 如果没有 docker 用户组， sudo groupadd docker groups 查看当前用户所在的用户组 如果不在 docker 用户组， sudo usermod -a -G d">
<meta property="og:type" content="article">
<meta property="og:title" content="公司服务器镜像编译环境">
<meta property="og:url" content="http://yoursite.com/2018/07/13/make/index.html">
<meta property="og:site_name" content="Drip">
<meta property="og:description" content="ssh centos@192.168.9.35 sudo yum install docker sudo service docker start sudo vi /etc/group 查看当前已有的用户组 如果没有 docker 用户组， sudo groupadd docker groups 查看当前用户所在的用户组 如果不在 docker 用户组， sudo usermod -a -G d">
<meta property="og:updated_time" content="2018-09-17T08:06:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="公司服务器镜像编译环境">
<meta name="twitter:description" content="ssh centos@192.168.9.35 sudo yum install docker sudo service docker start sudo vi /etc/group 查看当前已有的用户组 如果没有 docker 用户组， sudo groupadd docker groups 查看当前用户所在的用户组 如果不在 docker 用户组， sudo usermod -a -G d">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>公司服务器镜像编译环境</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/07/16/interledger/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/07/13/fabric-code/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/07/13/make/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/07/13/make/&text=公司服务器镜像编译环境"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/07/13/make/&title=公司服务器镜像编译环境"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/07/13/make/&is_video=false&description=公司服务器镜像编译环境"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=公司服务器镜像编译环境&body=Check out this article: http://yoursite.com/2018/07/13/make/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/07/13/make/&title=公司服务器镜像编译环境"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/07/13/make/&title=公司服务器镜像编译环境"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/07/13/make/&title=公司服务器镜像编译环境"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/07/13/make/&title=公司服务器镜像编译环境"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/07/13/make/&name=公司服务器镜像编译环境&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#EPEL"><span class="toc-number">1.</span> <span class="toc-text">EPEL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-中使用-awk，需要用两个-符号"><span class="toc-number">2.</span> <span class="toc-text">Makefile 中使用 awk，需要用两个 $$ 符号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile"><span class="toc-number">3.</span> <span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-规则"><span class="toc-number">4.</span> <span class="toc-text">Makefile 规则</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#如果在编译时遇到"><span class="toc-number">5.</span> <span class="toc-text">如果在编译时遇到</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译错误：ltdl-h-no-such-file"><span class="toc-number">6.</span> <span class="toc-text">编译错误：ltdl.h: no such file</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译中遇到-invalid-flag-in-cgo-LDFLAGS-xxx"><span class="toc-number">7.</span> <span class="toc-text">编译中遇到 invalid flag in #cgo LDFLAGS xxx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go-中调用-c-c"><span class="toc-number">8.</span> <span class="toc-text">go 中调用 c/c++</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go-项目中的一些编译配置"><span class="toc-number">9.</span> <span class="toc-text">go 项目中的一些编译配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tar-jc-中的-j-表示-bzip2-格式压缩，需要先安装该工具"><span class="toc-number">10.</span> <span class="toc-text">tar -jc 中的 j 表示 bzip2 格式压缩，需要先安装该工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-选项-CFLAGS-LDFLAGS-LIBS"><span class="toc-number">11.</span> <span class="toc-text">Makefile 选项 CFLAGS, LDFLAGS, LIBS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#库文件"><span class="toc-number">12.</span> <span class="toc-text">库文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gopath-bin-gopath-pkg-gopath-src"><span class="toc-number">13.</span> <span class="toc-text">gopath/bin, gopath/pkg, gopath/src</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go-build-go-install-go-get-go-run"><span class="toc-number">14.</span> <span class="toc-text">go build, go install, go get, go run</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        公司服务器镜像编译环境
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Drip</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-07-13T05:30:30.000Z" itemprop="datePublished">2018-07-13</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <ol>
<li>ssh centos@192.168.9.35</li>
<li>sudo yum install docker</li>
<li>sudo service docker start</li>
<li>sudo vi /etc/group 查看当前已有的用户组</li>
<li>如果没有 docker 用户组， sudo groupadd docker</li>
<li>groups 查看当前用户所在的用户组</li>
<li>如果不在 docker 用户组， sudo usermod -a -G docker centos</li>
<li>sudo service docker restart</li>
<li>sudo yum install go</li>
<li>sudo yum install git</li>
<li>sudo yum install python-pip（如果没有，则先执行 sudo yum install epel-release）</li>
<li>sudo pip install –upgrade pip</li>
<li>sudo yum install bzip2   用到了 bzip2 格式的压缩包，如果没有需要装一下</li>
<li>sudo yum install libtool-ltdl-devel       </li>
<li>sudo yum install openssl-devel</li>
<li>如果编译出现，配置 export CGO_CFLAGS_ALLOW=’.<em>‘，export CGO_LDFLAGS_ALLOW=’.</em>‘</li>
<li>/usr/lib/systemd/system/docker.service 中可以配置 docker api server 启动参数<br>ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock</li>
<li>最好使用 Server Version: 1.13.1 的 docker 版本，支持 swarm 比较好</li>
</ol>
<h1 id="EPEL"><a href="#EPEL" class="headerlink" title="EPEL"></a>EPEL</h1><p>EPEL的全称叫 Extra Packages for Enterprise Linux 。EPEL是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。装上了 EPEL之后，就相当于添加了一个第三方源。      </p>
<h1 id="Makefile-中使用-awk，需要用两个-符号"><a href="#Makefile-中使用-awk，需要用两个-符号" class="headerlink" title="Makefile 中使用 awk，需要用两个 $$ 符号"></a>Makefile 中使用 awk，需要用两个 $$ 符号</h1><p>awk <code>{print $$1}</code></p>
<h1 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h1><p><a href="https://blog.csdn.net/ruglcc/article/details/7814546" target="_blank" rel="external">教程</a><br><code>@</code>:    运行命令前如果不加 <code>@</code>，则会先输出该命令名称，然后在运行。如果加了 <code>@</code>，则不显示命令，直接运行。<br><code>:=</code>:   如果右边有变量的引用，只绑定其定义时的值，后续右侧的变量即使改变值，也不会改变左侧变量的值。<br><code>?=</code>:   如果左侧变量的值为空，则等于右边的值。<br><code>+=</code>:   拼接。<br><code>$@</code>:   该条规则的名称（也就是这条命令生成的文件）<br><code>$&lt;</code>:   依赖文件列表中的第一个文件<br><code>$^</code>:   依赖文件列表<br><code>all: dep1 dep2</code>:   <code>$@</code> 为 <code>all</code>，<code>$&lt;</code> 为 <code>dep1</code>，<code>$^</code> 为 <code>dep1 dep2</code><br><code>HELLO = hello</code>: 即定义变量，右侧一定是字符串，<code>HELLO = &#39;hello&#39;</code>，则右侧为带引号的字符串<br><code>export</code>:   可以 export 该变量至环境变量<br><code>@D</code>:   规则输出文件的目录<br><code>@F</code>:   规则输出文件的文件名<br><code>-</code>:    每当命令运行完后，make会检测每个命令的返回码，如果命令返回成功，那么make会执行下一条命令，当规则中所有的命令成功返回后，这个规则就算是成功完成了。如果一个规则中的某个命令出错了（命令退出码非零），那么make就会终止执行当前规则，这将有可能终止所有规则的执行。为了做到这一点，忽略命令的出错，我们可以在Makefile的命令行前加一个减号“-”（在Tab键之后），标记为不管命令出不出错都认为是成功的。              </p>
<p><code>cmd</code>(反引号) 等同于 $(shell cmd)         </p>
<p>Makefile 中的第一条规则，可以通过 <code>make</code> 直接触发       </p>
<p>Makefile 中可以直接定义变量： ARCH = Linux<br>Makefile 中可以调用函数： return = $(func arg1 arg2 …)<br>Makefile 中引用变量： $(ARG)<br>Makefile 中几个有用的函数： wildcard，notdir，patsubst，abspath         </p>
<p><code>wildcard</code>: 使用：SRC = $(wildcard <em>.c ./foo/</em>.c) 。搜索当前目录及./foo/下所有以.c结尾的文件，生成一个以空格间隔的文件名列表，并赋值给SRC.当前目录文件只有文件名，子目录下的文件名包含路径信息，比如./foor/bar.c。       </p>
<p><code>notdir</code>: 使用：SRC = $(notdir wildcard) 。去除所有的目录信息，SRC里的文件名列表将只有文件名。      </p>
<p><code>patsubst</code>: 使用：OBJ = $(patsubst %.c %.o $(SRC)) 。patsubst是patten substitude的缩写，匹配替代的意思。这句是在SRC中找到所有.c 结尾的文件，然后把所有的.c换成.o。       </p>
<p><code>abspath</code>: 获得某个路径的绝对路径（docker -v 挂载时需要宿主机的绝对路径）       </p>
<p><code>%</code>: 匹配任意字符串，并将其存入 % 中。       </p>
<p><code>.PHONY: dist</code>: 表示 dist 是个伪目标       </p>
<h1 id="Makefile-规则"><a href="#Makefile-规则" class="headerlink" title="Makefile 规则"></a>Makefile 规则</h1><p>target… : prerequisites …        </p>
<p>command       </p>
<p>target也就是一个目标文件，可以是Object File，也可以是执行文件。还可以是一个标签（Label），对于标签这种特性，在后续的“伪目标”章节中会有叙述。prerequisites就是，要生成那个target所需要的文件或是目标。command也就是make需要执行的命令。（任意的Shell命令）            </p>
<p>“伪目标”并不是一个文件，只是一个标签，由于“伪目标”不是文件，所以make无法生成它的依赖关系和决定它是否要执行。我们只有通过显示地指明这个“目标”才能让其生效。当然，“伪目标”的取名不能和文件名重名，不然其就失去了“伪目标”的意义了。当然，为了避免和文件重名的这种情况，我们可以使用一个特殊的标记“.PHONY”来显示地指明一个目标是“伪目标”，向make说明，不管是否有这个文件，这个目标就是“伪目标”。         </p>
<p>.PHONY : clean<br>只要有这个声明，不管是否有“clean”文件，要运行“clean”这个目标，只有“make clean”这样。          </p>
<p>伪目标一般没有依赖的文件。但是，我们也可以为伪目标指定所依赖的文件。伪目标同样可以作为“默认目标”，只要将其放在第一个。一个示例就是，如果你的Makefile需要一口气生成若干个可执行文件，但你只想简单地敲一个make完事，并且，所有的目标文件都写在一个Makefile中，那么你可以使用“伪目标”这个特性：           </p>
<p>.PHONY : all<br>all : prog1 prog2 prog3         </p>
<h1 id="如果在编译时遇到"><a href="#如果在编译时遇到" class="headerlink" title="如果在编译时遇到"></a>如果在编译时遇到</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make: <span class="built_in">stat</span>: Makefile: Permission denied</div></pre></td></tr></table></figure>
<p>可能是因为在 docker 容器内部运行时，没有该文件的权限<br>这是由于 selinux 默认开启的对文件的安全设置，使用 <code>chcon</code> 命令可以调整某个文件/目录下的文件安全配置<br>chcon命令：修改对象（文件）的安全上下文。比如：用户：角色：类型：安全级别<br>调用：<code>chcon -Rt svirt_sandbox_file_t /path/to/volume</code><br>或者：<code>docker run -v /var/db:/var/db:z rhel7 /bin/sh</code>  :z 会自动对挂载的host目录调用上一条命令<br>再者：<code>sudo docker run --privileged=true</code><br>甚者：<code>setenforce 0</code></p>
<h1 id="编译错误：ltdl-h-no-such-file"><a href="#编译错误：ltdl-h-no-such-file" class="headerlink" title="编译错误：ltdl.h: no such file"></a>编译错误：ltdl.h: no such file</h1><p>如果在ubunt操作系统中，只需安装：<br>apt install libltdl3-dev        </p>
<p>如果在centos操作系统中，只需安装：<br>yum install libtool-ltdl-devel       </p>
<h1 id="编译中遇到-invalid-flag-in-cgo-LDFLAGS-xxx"><a href="#编译中遇到-invalid-flag-in-cgo-LDFLAGS-xxx" class="headerlink" title="编译中遇到 invalid flag in #cgo LDFLAGS xxx"></a>编译中遇到 invalid flag in #cgo LDFLAGS xxx</h1><p>对于编译一些在 go 文件中调用 C/C++ 这样的库时。golang 为了安全起见，在 go 1.8.7/1.9.4/1.10 版本中设置了编译器配置白名单：<code>CGO_CFLAGS_ALLOW</code> 、 <code>CGO_CXXFLAGS_ALLOW</code> 等环境变量。 其值需要设置为正则表达式，如果想要将所有配置加入白名单，可以这样 <code>CGO_CFLAGS_ALLOW=&#39;.*&#39;</code></p>
<h1 id="go-中调用-c-c"><a href="#go-中调用-c-c" class="headerlink" title="go 中调用 c/c++"></a>go 中调用 c/c++</h1><p>需要在文件头部（package 下方）的注释块内 <code>/* */</code> 内写入 C/C++ 代码。然后在 <code>紧接着的</code> 写 <code>import &quot;C&quot;</code> 即可。 调用其中的方法借助这个库：<code>C.xxFunc(xx, xx)</code> 即可。       </p>
<p>对于这些在 go 文件中导入/定义的 c 代码，可以在注释块中写入 <code>// #cgo CFLAGS: xxx</code>, <code>// #cgo LDFLAGS: xxx</code> 来配置 c 的编译选项。       </p>
<p>通过 <code>go env</code> 可以看到默认的 CGO 配置项，例如：<br>CXX=”clang++”<br>CGO_ENABLED=”1”<br>CGO_CFLAGS=”-g -O2”<br>CGO_CPPFLAGS=””<br>CGO_CXXFLAGS=”-g -O2”<br>CGO_FFLAGS=”-g -O2”<br>CGO_LDFLAGS=”-g -O2”        </p>
<p>由于有些恶意的 go 代码中会嵌入恶意的 c 代码以及编译器参数。所以为了控制安全性，go 1.8.7/1.9.4/1.10 加入了白名单 <code>CGO_CFLAGS_ALLOW</code> 、 <code>CGO_CXXFLAGS_ALLOW</code> 控制 go 文件中注释块中的 cgo 配置项。        </p>
<h1 id="go-项目中的一些编译配置"><a href="#go-项目中的一些编译配置" class="headerlink" title="go 项目中的一些编译配置"></a>go 项目中的一些编译配置</h1><p><code>CGO_XXX</code> : 这些配置是作用于 GO 文件中调用 C 代码时的编译配置      </p>
<p><code>GO_LDFLAGS</code>: 这是是 makefile 中自定义的一个变量名，传递给 go build/install -ldflags “$(GO_LDFLAGS)” 其中 <code>-ldflags</code> 参数会传递给 <code>go tool link</code>，首先要介绍下 go 编译时会调用一些 go tools，可以用命令 <code>go tool</code> 查看，其中 <code>link</code> 工具负责连接函数库到 main 库，可以用 <code>go tool link [options] main.o</code> 来执行。其中 <code>options</code> 提供了很多功能，例如 <code>-X importpath.name=value</code> 可以给一个库里面暴露的字符串变量赋值。   </p>
<p><a href="https://juejin.im/post/5a62f7cff265da3e4c07e0ab" target="_blank" rel="external">文档</a></p>
<h1 id="tar-jc-中的-j-表示-bzip2-格式压缩，需要先安装该工具"><a href="#tar-jc-中的-j-表示-bzip2-格式压缩，需要先安装该工具" class="headerlink" title="tar -jc 中的 j 表示 bzip2 格式压缩，需要先安装该工具"></a>tar -jc 中的 j 表示 bzip2 格式压缩，需要先安装该工具</h1><h1 id="Makefile-选项-CFLAGS-LDFLAGS-LIBS"><a href="#Makefile-选项-CFLAGS-LDFLAGS-LIBS" class="headerlink" title="Makefile 选项 CFLAGS, LDFLAGS, LIBS"></a>Makefile 选项 CFLAGS, LDFLAGS, LIBS</h1><p>CFLAGS 表示用于 C 编译器的选项，<br>CXXFLAGS 表示用于 C++ 编译器的选项。<br>这两个变量实际上涵盖了编译和汇编两个步骤。       </p>
<p>CFLAGS： 指定头文件（.h文件）的路径，如：CFLAGS=-I/usr/include -I/path/include。同样地，安装一个包时会在安装路径下建立一个include目录，当安装过程中出现问题时，试着把以前安装的包的include目录加入到该变量中来。      </p>
<p>LDFLAGS：gcc 等编译器会用到的一些优化参数，也可以在里面指定库文件的位置。用法：LDFLAGS=-L/usr/lib -L/path/to/your/lib。每安装一个包都几乎一定的会在安装目录里建立一个lib目录。如果明明安装了某个包，而安装另一个包时，它愣是说找不到，可以抒那个包的lib路径加入的LDFALGS中试一下。      </p>
<p>LIBS：告诉链接器要链接哪些库文件，如LIBS = -lpthread -liconv        </p>
<p>其实不规范的话，可以把所有配置写在 CFLAGS 中，因为 Makefile 调用编译器时的命令为： <code>$(CC) $(CFLAGS) $(LDFLAGS) example.o   -o example</code>，这些只是变量名        </p>
<h1 id="库文件"><a href="#库文件" class="headerlink" title="库文件"></a>库文件</h1><p>linux 库文件分为静态库和动态库两种。静态库习惯以 .a 结尾，而动态库习惯以 .so (shared object) 结尾。而且必须以lib开头。      </p>
<p>首先：.o 文件就是对象文件（object），每个 c/c++ 文件会被编译成对象文件，最后被 link 为可执行文件          </p>
<p>多个 .o 文件的组合（ar 归档）为 .a 文件，即静态库。 用于被其他代码引用，link 至其他代码中        </p>
<p>.so 文件可以在代码运行时被引用     </p>
<p>例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># 注意：ar -rc [目标] [.o文件名]，目标一定要以lib开头。</span></div><div class="line">ar -rc libtest.a myalib.o </div><div class="line"></div><div class="line"><span class="comment"># 使用时候，在链接时候，加上选项 -l 后接库文件名，注意：必须是文件名去掉后缀和lib，</span></div><div class="line">gcc -o main  main.o -ltest</div></pre></td></tr></table></figure></p>
<h1 id="gopath-bin-gopath-pkg-gopath-src"><a href="#gopath-bin-gopath-pkg-gopath-src" class="headerlink" title="gopath/bin, gopath/pkg, gopath/src"></a>gopath/bin, gopath/pkg, gopath/src</h1><p>gopath/src: 存放源码的地方<br>gopath/bin: 存放可执行文件的地方<br>gopath/pkg: 存放库文件，比如 .a，golang 中，项目中使用的每一个库都会被编译成一份 xx.a 库文件存在于此     </p>
<h1 id="go-build-go-install-go-get-go-run"><a href="#go-build-go-install-go-get-go-run" class="headerlink" title="go build, go install, go get, go run"></a>go build, go install, go get, go run</h1><ol>
<li><p>go build：编译代码，可以通过 buildmode 选项配置编译类型：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">  go <span class="built_in">help</span> buildmode</div><div class="line">  <span class="comment"># 比如以下两种类型</span></div><div class="line">  -buildmode=archive</div><div class="line">          Build the listed non-main packages into .a files. Packages named</div><div class="line">          main are ignored.</div><div class="line"></div><div class="line">  -buildmode=default</div><div class="line">          Listed main packages are built into executables and listed</div><div class="line">          non-main packages are built into .a files (the default</div><div class="line">          behavior). </div><div class="line"></div><div class="line">  -buildmode=shared</div><div class="line">Combine all the listed non-main packages into a single shared</div><div class="line">library that will be used when building with the -linkshared</div><div class="line">option. Packages named main are ignored.</div></pre></td></tr></table></figure>
<p> 注意：只有 main 包编译后会被保存至当前目录，其他引用的 package 编译为 .a 文件，link 之后就会被删除。<br> go build 某个非 main 包，结果不会保存，但可以用于检查编译是否通过<br> go build 不加文件路径，默认编译当前文件夹下的所有 .go 文件，这与 go run 相反<br> go build -race 可以检测变量竞争   </p>
</li>
<li><p>go install: 首先 build，然后将可执行文件放入 bin, 库文件放入 pkg</p>
</li>
<li><p>go get: 首先下载代码，然后 go install</p>
</li>
<li><p>go run: 首先 build 代码，然后运行 main 可执行文件，注意结果文件不会保存，存放于某个临时目录。<br>注意：go run 需要传入文件</p>
</li>
</ol>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#EPEL"><span class="toc-number">1.</span> <span class="toc-text">EPEL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-中使用-awk，需要用两个-符号"><span class="toc-number">2.</span> <span class="toc-text">Makefile 中使用 awk，需要用两个 $$ 符号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile"><span class="toc-number">3.</span> <span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-规则"><span class="toc-number">4.</span> <span class="toc-text">Makefile 规则</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#如果在编译时遇到"><span class="toc-number">5.</span> <span class="toc-text">如果在编译时遇到</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译错误：ltdl-h-no-such-file"><span class="toc-number">6.</span> <span class="toc-text">编译错误：ltdl.h: no such file</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编译中遇到-invalid-flag-in-cgo-LDFLAGS-xxx"><span class="toc-number">7.</span> <span class="toc-text">编译中遇到 invalid flag in #cgo LDFLAGS xxx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go-中调用-c-c"><span class="toc-number">8.</span> <span class="toc-text">go 中调用 c/c++</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go-项目中的一些编译配置"><span class="toc-number">9.</span> <span class="toc-text">go 项目中的一些编译配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tar-jc-中的-j-表示-bzip2-格式压缩，需要先安装该工具"><span class="toc-number">10.</span> <span class="toc-text">tar -jc 中的 j 表示 bzip2 格式压缩，需要先安装该工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile-选项-CFLAGS-LDFLAGS-LIBS"><span class="toc-number">11.</span> <span class="toc-text">Makefile 选项 CFLAGS, LDFLAGS, LIBS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#库文件"><span class="toc-number">12.</span> <span class="toc-text">库文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gopath-bin-gopath-pkg-gopath-src"><span class="toc-number">13.</span> <span class="toc-text">gopath/bin, gopath/pkg, gopath/src</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go-build-go-install-go-get-go-run"><span class="toc-number">14.</span> <span class="toc-text">go build, go install, go get, go run</span></a></li></ol>
    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Landleany
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


